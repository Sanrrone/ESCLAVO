source("Classes/16s18sits_module.R")
library(phyloseq)

getpipeline<-function(){
  new("pipeline",
      id = "16s18sits",
      name = "16S-18S/ITS",
      version = 1.0,
      image = "images/16srrna.png",
      steps = list(
        statusb = list(folder="0-raw",
                       software="MultiQC",
                       version="1.7", #system("multiqc --version |tail -n1 | awk '{print $NF}'",intern = T),
                       spath=system("which multiqc",intern = T),
                       stepName="Reads before QC",
                       stepID="rbqc",
                       icon = icon("stream"),
                       iconHTML='fa fa-stream',
                       tabcontentUI=list(ui=statusbUIm, 
                                         id="statusbmodule"),
                       tabcontentSrv=list(server=statusbTabModule,
                                          id="statusbmodule")),
        qc = list(folder="1-qc",
                  software="DADA2",
                  version=as.character(packageVersion("dada2")),
                  spath=find.package("dada2"),
                  stepName="QC status",
                  stepID="qc",
                  icon = icon("filter"),
                  iconHTML='fa fa-filter',
                  tabcontentUI=list(ui=qcUIm, 
                                    id="qcmodule"),
                  tabcontentSrv=list(server=qcModule,
                                     id="qcmodule")),
        statusa = list(folder="1-qc",
                       software="MultiQC",
                       version="1.7",#system("multiqc --version |tail -n1 | awk '{print $NF}'",intern = T),
                       spath=system("which multiqc",intern = T),
                       stepName="Reads after QC",
                       stepID="raqc",
                       icon = icon("stream"),
                       iconHTML='fa fa-stream',
                       tabcontentUI=list(ui=statusaUIm, 
                                         id="statusamodule"),
                       tabcontentSrv=list(server=statusaTabModule,
                                          id="statusamodule")),
        taxInsight = list(folder="2-taxInsight",
                          software="DADA2",
                          version=as.character(packageVersion("dada2")),
                          spath=find.package("dada2"),
                          stepName="Taxonomic counts",
                          stepID="tc",
                          icon = icon("microscope"),
                          iconHTML='fa fa-microscope',
                          tabcontentUI=list(ui=taxCountTabUIm, 
                                            id="taxinsightmodule"),
                          tabcontentSrv=list(server=taxCountTabModule,
                                             id="taxinsightmodule"))
      ),
      stepsOptions = list(
        color = "danger",
        collapsed = T
      )
  )
}